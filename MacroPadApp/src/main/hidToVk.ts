// =============================================================================
// hidToVk.ts — Map HID Usage IDs → Windows Virtual Key codes
// =============================================================================

/** HID key code → Windows VK code */
export const HID_TO_VK: Record<number, number> = {
  // Letters A-Z (HID 0x04-0x1D → VK 0x41-0x5A)
  0x04: 0x41, 0x05: 0x42, 0x06: 0x43, 0x07: 0x44, 0x08: 0x45,
  0x09: 0x46, 0x0a: 0x47, 0x0b: 0x48, 0x0c: 0x49, 0x0d: 0x4a,
  0x0e: 0x4b, 0x0f: 0x4c, 0x10: 0x4d, 0x11: 0x4e, 0x12: 0x4f,
  0x13: 0x50, 0x14: 0x51, 0x15: 0x52, 0x16: 0x53, 0x17: 0x54,
  0x18: 0x55, 0x19: 0x56, 0x1a: 0x57, 0x1b: 0x58, 0x1c: 0x59,
  0x1d: 0x5a,

  // Numbers 1-9, 0
  0x1e: 0x31, 0x1f: 0x32, 0x20: 0x33, 0x21: 0x34, 0x22: 0x35,
  0x23: 0x36, 0x24: 0x37, 0x25: 0x38, 0x26: 0x39, 0x27: 0x30,

  // Control keys
  0x28: 0x0d,  // Enter
  0x29: 0x1b,  // Escape
  0x2a: 0x08,  // Backspace
  0x2b: 0x09,  // Tab
  0x2c: 0x20,  // Space
  0x2d: 0xbd,  // -  (OEM_MINUS)
  0x2e: 0xbb,  // =  (OEM_PLUS)
  0x2f: 0xdb,  // [  (OEM_4)
  0x30: 0xdd,  // ]  (OEM_6)
  0x31: 0xdc,  // \  (OEM_5)
  0x33: 0xba,  // ;  (OEM_1)
  0x34: 0xde,  // '  (OEM_7)
  0x35: 0xc0,  // `  (OEM_3)
  0x36: 0xbc,  // ,  (OEM_COMMA)
  0x37: 0xbe,  // .  (OEM_PERIOD)
  0x38: 0xbf,  // /  (OEM_2)
  0x39: 0x14,  // CapsLock

  // Function keys F1-F12
  0x3a: 0x70, 0x3b: 0x71, 0x3c: 0x72, 0x3d: 0x73, 0x3e: 0x74,
  0x3f: 0x75, 0x40: 0x76, 0x41: 0x77, 0x42: 0x78, 0x43: 0x79,
  0x44: 0x7a, 0x45: 0x7b,

  // Navigation & editing
  0x46: 0x2c,  // PrintScreen
  0x47: 0x91,  // ScrollLock
  0x48: 0x13,  // Pause
  0x49: 0x2d,  // Insert
  0x4a: 0x24,  // Home
  0x4b: 0x21,  // PageUp
  0x4c: 0x2e,  // Delete
  0x4d: 0x23,  // End
  0x4e: 0x22,  // PageDown
  0x4f: 0x27,  // Right Arrow
  0x50: 0x25,  // Left Arrow
  0x51: 0x28,  // Down Arrow
  0x52: 0x26,  // Up Arrow

  // Media keys (HID Consumer Page)
  0xe8: 0xae,  // Volume Down
  0xe9: 0xaf,  // Volume Up
  0xea: 0xad,  // Mute
  0xb5: 0xb0,  // Next Track
  0xb6: 0xb1,  // Prev Track
  0xb7: 0xb2,  // Stop
  0xcd: 0xb3   // Play/Pause
}

/** HID modifier bitmask bits → Windows VK codes */
export const MOD_BIT_TO_VK: [number, number][] = [
  [0x01, 0xa2],  // Left Ctrl
  [0x02, 0xa0],  // Left Shift
  [0x04, 0xa4],  // Left Alt
  [0x08, 0x5b],  // Left Win
  [0x10, 0xa3],  // Right Ctrl
  [0x20, 0xa1],  // Right Shift
  [0x40, 0xa5],  // Right Alt
  [0x80, 0x5c]   // Right Win
]

/** Extract active modifier VK codes from an HID modifier bitmask */
export function modBitsToVkList(modBits: number): number[] {
  const vks: number[] = []
  for (const [bit, vk] of MOD_BIT_TO_VK) {
    if (modBits & bit) vks.push(vk)
  }
  return vks
}
